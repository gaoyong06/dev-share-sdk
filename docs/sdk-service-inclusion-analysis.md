# SDK 服务包含分析：哪些服务应该放在 SDK 中？

## 📋 服务列表分析

### ✅ 已包含在 SDK 中的服务

| 服务 | 用途 | 是否应该包含 | 理由 |
|------|------|------------|------|
| **passport-service** | 用户认证、注册、登录 | ✅ **是** | 核心基础服务，所有应用都需要 |
| **asset-service** | 文件上传、存储、管理 | ✅ **是** | 通用文件服务，独立开发者常用 |
| **notification-service** | 通知发送（短信、邮件、推送） | ✅ **是** | 通用通知服务，独立开发者常用 |
| **subscription-service** | 订阅管理 | ✅ **是** | SaaS 核心功能，独立开发者常用 |
| **billing-service** | 计费服务（查询功能） | ✅ **是** | 开发者需要查询账单、余额、统计，集成到自己的系统 |
| **api-key-service** | API Key 管理 | ⚠️ **可选** | 主要使用场景是 Web UI，API 主要用于自动化场景 |
| **payment-service** | 支付服务 | ✅ **是** | 通用支付服务，独立开发者常用 |
| **marketing-service** | 营销服务（优惠券等） | ✅ **是** | 通用营销功能，独立开发者常用 |

### ❓ 需要分析的服务

| 服务 | 用途 | 建议 | 理由 |
|------|------|------|------|
| **short-link-service** | 短链接生成、跳转、统计 | ✅ **应该包含** | 通用工具服务，独立开发者常用（类似 bit.ly） |
| **analytics-service** | 数据分析、事件追踪、UTM 管理 | ⚠️ **独立 SDK** | 已有独立的 `analytics-sdk-js`，功能复杂，建议保持独立 |
| **question-hub-service** | K12 题库平台 | ❌ **不应该包含** | 业务特定服务，不是通用 BaaS 能力 |
| **table-plan** | 智能桌位安排系统（婚礼、会议等） | ❌ **不应该包含** | 业务特定服务，不是通用 BaaS 能力 |

### ❌ 不应该包含的服务

| 服务 | 用途 | 理由 |
|------|------|------|
| **question-hub-consumer** | 后台消息消费者 | 后台服务，不对外暴露 API |
| **question-hub-document-service** | 文档转换服务 | 后台服务，不对外暴露 API |

---

## 🎯 判断标准

### 1. **面向开发者的公共服务** ✅
- **特征**：独立开发者可以直接使用的通用能力
- **示例**：认证、文件存储、通知、支付、订阅、计费
- **判断**：**应该包含**

### 2. **通用工具服务** ✅
- **特征**：提供通用工具能力，不绑定特定业务
- **示例**：短链接、数据分析（但 analytics 已有独立 SDK）
- **判断**：**应该包含**（但 analytics 建议保持独立）

### 3. **业务特定服务** ❌
- **特征**：服务于特定业务场景，不是通用 BaaS 能力
- **示例**：K12 题库平台
- **判断**：**不应该包含**

### 4. **后台服务** ❌
- **特征**：不对外暴露 API，仅内部使用
- **示例**：消息消费者、后台任务处理
- **判断**：**不应该包含**

---

## 📊 详细分析

### 1. short-link-service ✅ **应该包含**

**服务能力**：
- 短链接生成（Base62 编码）
- 短链接跳转（HTTP 302）
- 点击统计（设备、浏览器、地域等）
- 自定义后缀支持
- 过期时间管理
- 批量生成支持
- 高级功能：A/B 测试、智能跳转、营销功能

**使用场景**：
- 独立开发者需要短链接功能（类似 bit.ly、tinyurl）
- 营销推广链接管理
- 链接点击统计和分析

**行业对标**：
- Bitly API
- TinyURL API
- Rebrandly API

**结论**：✅ **应该包含在 SDK 中**

**理由**：
1. 通用工具服务，不绑定特定业务
2. 独立开发者常用功能
3. 可以作为 BaaS 产品的一个卖点
4. 与现有服务（analytics、marketing）有协同效应

---

### 2. analytics-service ⚠️ **保持独立 SDK**

**服务能力**：
- 事件追踪（页面浏览、点击、自定义事件）
- UTM 管理
- 渠道归因分析
- 漏斗分析
- 留存分析
- 用户分析
- AI 智能建议

**当前状态**：
- ✅ 已有独立的 `analytics-sdk-js`
- ✅ 功能完整且复杂
- ✅ 有自己的发布流程

**使用场景**：
- 独立开发者需要数据分析能力
- 渠道归因和 ROI 分析
- 用户行为分析

**行业对标**：
- Google Analytics SDK
- Mixpanel SDK
- Amplitude SDK

**结论**：⚠️ **保持独立 SDK，不合并到主 SDK**

**理由**：
1. 功能复杂，独立 SDK 更合适
2. 已有成熟的独立 SDK
3. 可以按需安装，减少主 SDK 体积
4. 独立版本管理更灵活

**建议**：
- 保持 `analytics-sdk-js` 独立
- 在主 SDK 文档中引用 analytics SDK
- 可以考虑在主 SDK 中提供轻量级的集成方式

---

### 3. question-hub-service ❌ **不应该包含**

**服务能力**：
- 题目管理（CRUD、搜索、筛选）
- 题目集管理
- Word 文档转换
- 练习会话管理
- 答题记录管理
- 错题本管理
- 学习报告生成

**使用场景**：
- K12 教育平台
- 题库业务

**结论**：❌ **不应该包含在 SDK 中**

**理由**：
1. 业务特定服务，不是通用 BaaS 能力
2. 面向特定行业（K12 教育）
3. 独立开发者一般不需要题库功能
4. 不符合 BaaS 产品的定位

**建议**：
- 作为内部业务服务，不对外暴露
- 如果需要，可以单独提供 API 文档
- 不放在通用 SDK 中

---

### 4. table-plan ❌ **不应该包含**

**服务能力**：
- 嘉宾信息管理
- 桌位布局管理
- 座位约束管理
- 智能座位分配（遗传算法）
- 手动调整功能
- 导出功能（座位安排图、嘉宾名单）

**使用场景**：
- 婚礼、会议、宴会等活动的座位安排
- 特定业务场景

**结论**：❌ **不应该包含在 SDK 中**

**理由**：
1. 业务特定服务，不是通用 BaaS 能力
2. 面向特定场景（活动座位安排）
3. 独立开发者一般不需要此功能
4. 不符合 BaaS 产品的定位

**建议**：
- 作为内部业务服务，不对外暴露
- 如果需要，可以单独提供 API 文档
- 不放在通用 SDK 中

---

## 🏗️ 推荐方案

### 方案 A：核心 SDK + 独立 SDK（推荐）

```
┌─────────────────────────────────────────┐
│      @atseeker/sdk (核心 SDK)            │
│  ┌───────────────────────────────────┐  │
│  │  核心公共服务                      │  │
│  │  - passport (认证)                │  │
│  │  - asset (文件)                    │  │
│  │  - notification (通知)             │  │
│  │  - subscription (订阅)             │  │
│  │  - billing (计费)                  │  │
│  │  - api-key (API Key)               │  │
│  │  - payment (支付)                  │  │
│  │  - marketing (营销)                 │  │
│  │  - short-link (短链接) ✅ 新增     │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
           ▲                    ▲
           │                    │
    ┌──────┴──────┐    ┌────────┴────────┐
    │ 内部项目使用  │    │  外部开发者使用   │
    └─────────────┘    └─────────────────┘

┌─────────────────────────────────────────┐
│   @atseeker/analytics-sdk (独立 SDK)    │
│  - 事件追踪                              │
│  - UTM 管理                              │
│  - 数据分析                              │
└─────────────────────────────────────────┘
```

**优势**：
- ✅ 核心 SDK 保持轻量
- ✅ 按需安装，减少体积
- ✅ 独立版本管理
- ✅ 符合行业实践（如 Google Analytics SDK）

---

### 方案 B：统一 SDK（备选）

将所有服务（包括 analytics）都放在一个 SDK 中。

**优势**：
- ✅ 一站式解决方案
- ✅ 统一的 API 风格

**劣势**：
- ❌ SDK 体积较大
- ❌ 不需要 analytics 的开发者也要安装
- ❌ 版本管理复杂

**结论**：不推荐，因为 analytics 功能复杂且已有独立 SDK。

---

## 📋 实施建议

### 阶段 1：完善核心 SDK（当前）
1. ✅ 保持现有服务（passport, asset, notification, subscription, billing, api-key, payment, marketing）
2. ✅ 添加 `short-link-service` 到 SDK

### 阶段 2：独立 SDK 管理
1. ✅ 保持 `analytics-sdk-js` 独立
2. ✅ 在主 SDK 文档中引用 analytics SDK
3. ✅ 提供集成示例

### 阶段 3：文档和示例
1. ✅ 更新 SDK 文档，说明哪些服务在核心 SDK，哪些在独立 SDK
2. ✅ 提供完整的使用示例
3. ✅ 在 dev-share-web 中展示 SDK 使用

---

## 🎯 最终建议

### ✅ 应该包含在 SDK 中的服务（8-9个）

**核心业务功能**（8个）：
1. **passport-service** ✅ (已包含)
2. **asset-service** ✅ (已包含)
3. **notification-service** ✅ (已包含)
4. **subscription-service** ✅ (已包含)
5. **billing-service** ✅ (已包含) - **仅查询功能**（GetAccount, ListRecords, GetStats*, Recharge）
6. **payment-service** ✅ (已包含)
7. **marketing-service** ✅ (已包含)
8. **short-link-service** ✅ **建议新增**

**平台管理功能**（可选，1个）：
9. **api-key-service** ⚠️ **可选包含** - 主要用于自动化场景（CI/CD、脚本），主要使用场景是 Web UI

### ⚠️ 保持独立的 SDK

1. **analytics-service** → `@atseeker/analytics-sdk` (已有)

### ❌ 不应该包含的服务

1. **question-hub-service** - 业务特定服务
2. **question-hub-consumer** - 后台服务
3. **question-hub-document-service** - 后台服务
4. **table-plan** - 业务特定服务（智能桌位安排）

---

## 💡 关键决策点

### 1. short-link-service 是否应该包含？
**答案：是**
- ✅ 通用工具服务
- ✅ 独立开发者常用
- ✅ 可以作为 BaaS 产品卖点

### 2. analytics-service 是否应该合并到主 SDK？
**答案：否**
- ✅ 已有独立 SDK
- ✅ 功能复杂，独立管理更合适
- ✅ 按需安装，减少体积

### 3. question-hub-service 是否应该包含？
**答案：否**
- ❌ 业务特定服务
- ❌ 不符合 BaaS 产品定位

---

## 📝 总结

**推荐方案**：
- **核心 SDK** (`@atseeker/sdk`)：包含 8 个核心业务服务 + short-link
  - passport, asset, notification, subscription, billing（查询功能）, payment, marketing, short-link
- **可选模块** (`@atseeker/sdk/admin`)：平台管理功能（可选）
  - api-key-service（API Key 和 App 管理）
- **独立 SDK** (`@atseeker/analytics-sdk`)：保持独立
- **业务服务**：不包含在 SDK 中

**核心价值**：
- 🎯 提供通用 BaaS 能力
- 🛠️ 保持 SDK 轻量和灵活
- 🚀 支持按需安装和使用
- 📦 符合行业最佳实践

**关键决策**：
- ✅ **billing-service**：应该包含（查询功能，开发者需要集成到自己的系统）
- ⚠️ **api-key-service**：可选包含（主要使用场景是 Web UI，API 主要用于自动化场景）

**详细分析**：参见 `docs/api-key-billing-sdk-analysis.md`
